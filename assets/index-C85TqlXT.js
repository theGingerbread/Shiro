import{r as e,j as P}from"./index-Bly4qCj0.js";import{M as S,u as k,P as w,a as W,L as A}from"./proxy-B3lsIjW6.js";class D extends e.Component{getSnapshotBeforeUpdate(o){const t=this.props.childRef.current;if(t&&o.isPresent&&!this.props.isPresent){const s=t.offsetParent,c=s instanceof HTMLElement&&s.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=c-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function H({children:n,isPresent:o,anchorX:t}){const s=e.useId(),c=e.useRef(null),r=e.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:d}=e.useContext(S);return e.useInsertionEffect(()=>{const{width:x,height:u,top:m,left:i,right:p}=r.current;if(o||!c.current||!x||!u)return;const a=t==="left"?`left: ${i}`:`right: ${p}`;c.current.dataset.motionPopId=s;const f=document.createElement("style");return d&&(f.nonce=d),document.head.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${u}px !important;
            ${a}px !important;
            top: ${m}px !important;
          }
        `),()=>{document.head.removeChild(f)}},[o]),P.jsx(D,{isPresent:o,childRef:c,sizeRef:r,children:e.cloneElement(n,{ref:c})})}const K=({children:n,initial:o,isPresent:t,onExitComplete:s,custom:c,presenceAffectsLayout:r,mode:d,anchorX:x})=>{const u=k(U),m=e.useId(),i=e.useCallback(a=>{u.set(a,!0);for(const f of u.values())if(!f)return;s&&s()},[u,s]),p=e.useMemo(()=>({id:m,initial:o,isPresent:t,custom:c,onExitComplete:i,register:a=>(u.set(a,!1),()=>u.delete(a))}),r?[Math.random(),i]:[t,i]);return e.useMemo(()=>{u.forEach((a,f)=>u.set(f,!1))},[t]),e.useEffect(()=>{!t&&!u.size&&s&&s()},[t]),d==="popLayout"&&(n=P.jsx(H,{isPresent:t,anchorX:x,children:n})),P.jsx(w.Provider,{value:p,children:n})};function U(){return new Map}function B(n=!0){const o=e.useContext(w);if(o===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:c}=o,r=e.useId();e.useEffect(()=>{if(n)return c(r)},[n]);const d=e.useCallback(()=>n&&s&&s(r),[r,s,n]);return!t&&s?[!1,d]:[!0]}function V(){return F(e.useContext(w))}function F(n){return n===null?!0:n.isPresent}const R=n=>n.key||"";function $(n){const o=[];return e.Children.forEach(n,t=>{e.isValidElement(t)&&o.push(t)}),o}const X=({children:n,custom:o,initial:t=!0,onExitComplete:s,presenceAffectsLayout:c=!0,mode:r="sync",propagate:d=!1,anchorX:x="left"})=>{const[u,m]=B(d),i=e.useMemo(()=>$(n),[n]),p=d&&!u?[]:i.map(R),a=e.useRef(!0),f=e.useRef(i),g=k(()=>new Map),[z,L]=e.useState(i),[C,j]=e.useState(i);W(()=>{a.current=!1,f.current=i;for(let h=0;h<C.length;h++){const l=R(C[h]);p.includes(l)?g.delete(l):g.get(l)!==!0&&g.set(l,!1)}},[C,p.length,p.join("-")]);const y=[];if(i!==z){let h=[...i];for(let l=0;l<C.length;l++){const E=C[l],M=R(E);p.includes(M)||(h.splice(l,0,E),y.push(E))}return r==="wait"&&y.length&&(h=y),j($(h)),L(i),null}const{forceRender:v}=e.useContext(A);return P.jsx(P.Fragment,{children:C.map(h=>{const l=R(h),E=d&&!u?!1:i===C||p.includes(l),M=()=>{if(g.has(l))g.set(l,!0);else return;let I=!0;g.forEach(T=>{T||(I=!1)}),I&&(v?.(),j(f.current),d&&m?.(),s&&s())};return P.jsx(K,{isPresent:E,initial:!a.current||t?void 0:!1,custom:o,presenceAffectsLayout:c,mode:r,onExitComplete:E?void 0:M,anchorX:x,children:h},l)})})};export{X as A,V as a,B as u};
